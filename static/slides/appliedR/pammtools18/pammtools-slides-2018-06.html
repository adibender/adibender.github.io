<!DOCTYPE html>
<html>
  <head>
    <title>pammtools: Piece-wise exponential Additive Mixed Modeling tools</title>
    <meta charset="utf-8">
    <meta name="author" content="Andreas Bender, Fabian Scheipl" />
    <meta name="author" content="Department of Statistics, LMU Munich" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# pammtools: Piece-wise exponential Additive Mixed Modeling tools
### Andreas Bender, Fabian Scheipl
### Department of Statistics, LMU Munich
### 2018/06/20

---

# Outline
&lt;link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous"&gt;

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.font150[
- Introduction

- Time-varying Effects

- Cumulative effects

]

???
`$$\newcommand{\ra}{\rightarrow}
\newcommand{\bs}[1]{\boldsymbol{#1}}
\newcommand{\tn}[1]{\textnormal{#1}}
\newcommand{\mbf}[1]{\mathbf{#1}}
\newcommand{\nn}{\nonumber}
\newcommand{\ub}{\underbrace}
\newcommand{\tbf}[1]{\textbf{#1}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\bfx}{\mathbf{x}}
\newcommand{\bfX}{\mathbf{X}}
\newcommand{\bff}{\mathbf{f}}
\newcommand{\bsbeta}{\boldsymbol{\beta}}
\newcommand{\bsgamma}{\boldsymbol{\gamma}}
\newcommand{\bslambda}{\boldsymbol{\lambda}}
\newcommand{\bfS}{\mathbf{S}}
\newcommand{\bfz}{\mathbf{z}}
\newcommand{\bfZ}{\mathbf{Z}}
\newcommand{\tz}{t_z}
\newcommand{\tlag}{t_{\text{lag}}}
\newcommand{\tlead}{t_{\text{lead}}}
\newcommand{\tw}{\mathcal{T}_e(t)}
\newcommand{\Tw}[1]{\mathcal{T}^{#1}}
\newcommand{\tilt}{\tilde{t}}
\newcommand{\Zi}{\mathcal{Z}_i(t)}
\newcommand{\CI}{C1}
\newcommand{\CII}{C2}
\newcommand{\CIII}{C3}
\newcommand{\gCII}{g_{_{\CII}}}
\newcommand{\gCIII}{g_{_{\CIII}}}
\newcommand{\gammaEst}{\hat{\gamma}_g^r}
\newcommand{\hatEj}{\hat{e}_{j, r}}
\newcommand{\diag}{\operatorname{diag}}
\newcommand{\rpexp}{\operatorname{rpexp}}
\newcommand{\Rlang}{\textbf{\textsf{R}}}
\newcommand{\code}[1]{{\small \texttt{#1}}}$$`




---
# Introduction
- It can be shown that under certain conditions (and after appropriate data preparation)
the Cox model ([Cox, 1972](http://links.jstor.org/sici?sici=0035-9246\%281972\%2934\%3A2\%3C187\%3ARMAL\%3E2.0.CO\%3B2-6)) can be estimated using Poisson Regression

- Such models are called *Piece-wise Exponential Models* (PEM);
[Whitehead (1980)](http://www.jstor.org/stable/2346901); [Friedman (1982)](http://www.jstor.org/stable/2240502)

- PEMs have some disadvantages (compared to Cox regression), but can be improved
by switching to *Piece-wise exponential Additive (Mixed) Models* (PA(M)Ms),
where the baseline hazard (and time-varying effects) are estimated by penalized
splines

- Essentially, this allows the usage of methods and inference procedures
developed for Generalized Additive (Mixed) Models (GAM(M)s) in the context
of time-to-event data analysis (e.g., use `mgcv::gam` or `mboost` for estimation)

- PAMMs are powerful, but data pre-processing and model evaluation can be
cumbersome due to data structure (and lack of readily available tools/software)

- The **`pammtools`** package provides utility functions that facilitate
working with PAMMs

---
# Introduction

- The `tumor` data from the **`pammtools`** package contains:
  - right-censored time-until death (`days`)
  - status indicator (`status`, 0 = censored, 1 = died)
  - covariates: `charlson_score` (Comorbidities),
  `age`, `sex`, `complications`, `metastases`, ...

<div id="htmlwidget-333ca8a23c3c02a9e6f5" style="width:600px;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-333ca8a23c3c02a9e6f5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776"],[579,1192,308,33,397,1219,1238,1074,1483,1430,1542,433,1217,257,27,214,1624,257,1406,435,90,1266,1225,680,139,3506,1184,209,2252,2652,1467,609,625,95,530,62,1184,613,40,1853,1596,610,1296,1247,304,831,55,498,1550,1465,929,632,235,1081,817,1478,532,741,1089,460,3669,519,1142,870,816,1365,1312,157,252,442,223,285,550,700,454,1473,941,3085,624,2770,150,1093,1367,73,126,210,3177,2360,1117,1799,2599,2939,95,294,469,805,611,448,235,307,840,6,814,1586,1016,757,1595,2065,1574,652,123,888,47,1169,64,741,1029,1625,729,1237,2097,2595,673,242,1469,959,859,1008,320,569,201,5,854,165,1468,2845,1258,1549,153,352,14,2692,52,26,8,491,1007,1455,1243,928,569,289,469,682,1482,1718,10,10,2023,1357,20,311,1181,2147,2169,151,8,1820,2588,3146,538,399,2946,365,2443,12,298,347,352,69,3789,2131,205,193,2414,173,353,850,1147,1703,2741,1978,1605,1174,374,667,691,960,463,2146,893,1162,1643,1364,1237,420,209,799,126,658,14,754,1895,1371,1009,1171,581,1867,399,2958,587,773,3633,748,2772,1689,1308,518,137,397,361,470,1995,572,145,1358,293,681,995,870,1071,1170,2395,697,58,2883,1382,3278,2011,2956,208,119,43,355,727,1123,561,2594,992,1385,312,419,11,7,2160,367,1497,1314,119,1126,405,294,1303,1259,3806,1373,3415,1385,647,43,1101,1154,2465,206,394,648,343,2488,1897,1184,16,336,1360,2427,1535,1502,2205,1031,1713,1283,1710,136,2494,1342,652,1959,690,727,454,427,147,2142,1752,1701,218,326,444,947,792,685,845,465,952,196,236,2543,560,2113,1393,8,230,1848,261,1846,2285,146,1634,5,889,559,1319,1239,1457,1323,21,417,1021,558,326,71,482,1553,708,829,3085,1386,802,1273,660,311,268,245,2289,1283,1344,1997,1771,883,2239,470,92,274,77,1260,370,2000,758,977,755,218,957,1015,820,89,446,861,924,1402,700,1257,110,1353,311,742,687,18,3,615,685,854,186,155,2737,1,134,126,1303,140,1702,888,52,1004,6,1388,730,60,1910,1707,1351,283,650,955,897,1389,1779,1360,15,54,1194,745,1217,495,1279,85,1046,576,151,25,302,366,1090,21,595,1466,155,657,1217,829,1302,1459,723,67,755,10,1836,2172,651,2575,3568,12,1015,1166,13,933,607,645,316,317,650,1619,144,524,1496,2253,903,743,1450,943,886,149,11,958,1678,3538,1349,1780,668,13,279,2984,2370,65,179,1114,184,1707,882,239,2847,958,2414,914,238,584,1925,810,903,643,846,20,784,11,11,1273,2131,580,188,359,549,1032,2064,28,709,901,1280,514,853,611,2868,613,2106,247,431,3646,562,592,2113,420,660,167,1256,277,498,1086,940,281,650,840,1827,934,1092,568,3326,385,1980,7,818,2043,2299,221,519,1299,276,834,11,534,1533,28,238,2151,2637,825,2245,2497,980,1811,1204,160,2841,1023,930,750,1580,716,822,1642,179,364,160,686,1093,2587,637,1189,441,680,195,30,229,2808,1483,2371,2417,1711,898,2164,464,1940,2200,1946,2019,1012,827,1383,993,2102,2906,830,794,432,253,261,545,858,1289,656,258,3350,2814,1667,2023,1413,1538,2027,2085,1354,916,804,1416,796,393,796,2085,2057,707,26,1275,760,553,2361,2270,981,1174,37,12,533,111,132,526,218,1240,250,930,593,849,2268,1708,1397,1072,206,1172,13,213,2637,3068,1580,1024,1712,1421,816,2632,2127,500,12,148,432,10,2500,502,109,10,1911,557,636,551,538,234,1435,643,1742,934,718,2,1024,2009,146,1073,2393,870,1793,1948,2281,727,698,1148,1350,1319,1012,268,642,1716,1282,5,1295,770,42,426,1554,35,5,3034,319,705,1344,852,211,999,849,596,434,1873,1599,215,515,5,154,646,1681,119,437,1072,1477,1454,2157,2049,345,1032,307,1204,1246,666,1322,586,44,1497,1263,148,1629,2940,27,551,1617,410,3110,1498,3065],[0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,1,0,1,0,0,0,0,1,0,1,1,0,0,1,0,0,0,1,1,0,1,0,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,0,0,1,0,0,0,0,1,1,0,1,1,1,0,0,0,0,0,0,1,1,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,1,0,1,0,1,0,0,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1,0,0,1,1,0,1,1,0,1,1,1,1,1,0,1,0,1,1,0,0,1,0,0,1,0,0,1,1,0,0,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,0,1,0,0,1,0,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,0,0,1,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,1,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,1,1,0,0,1,0,1,0,1,1,0,0,1,1,0,1,1,1,1,0,0,0,1,1,1,0,0,1,0,1,0,1,0,1,1,1,1,1,1,0,0,0,0,0,1,1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,1,0,1,1,0,1,0,0,1,0,0,0,0,0,0,1,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,1,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,0,1,0,0,1,0,1,1,0,0,0,0,0,1,0,1,1,1,0,1,1,1,1,0,1,0,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,1,0,0,1,1,0,0,1,0,1,1,1,0,0,1,1,1,1,1,0,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,0,1,1,0,1,0,1,1,0,1,1,0,0,0,0,1,0,1,0,1,0,0,1,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,1,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,1,0,0,0,1,1,0,1,0,1,1,1,0,0,1,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,1,0,0,0,0,0,1,1,1,0,1,1,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,1,1,0,1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,0,1,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,0,1,0,0,0],[2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,4,2,2,2,4,3,3,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,4,3,2,2,2,2,2,3,2,2,2,2,3,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,7,2,3,2,3,3,7,5,3,5,5,2,5,2,2,2,3,3,2,3,4,4,2,2,2,2,3,2,4,5,2,3,3,3,3,3,2,2,4,7,4,5,4,3,2,3,2,2,4,2,2,2,4,3,3,3,2,2,4,4,2,2,3,4,3,3,7,4,5,5,3,3,6,2,2,2,2,2,3,4,3,3,3,5,3,3,2,2,4,3,8,2,4,2,8,2,2,3,2,2,8,3,3,3,2,2,2,2,2,3,3,3,2,2,2,2,5,3,3,3,2,3,3,2,2,2,2,3,2,3,3,3,7,3,3,5,2,3,3,3,5,2,4,2,3,3,2,3,3,3,3,3,2,2,2,3,2,3,3,3,2,4,3,3,2,5,2,2,2,2,2,2,2,2,2,3,3,6,3,3,4,4,2,2,2,2,3,2,4,5,2,3,2,2,2,2,2,4,4,4,3,2,2,2,2,2,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,7,3,3,4,5,8,5,7,4,2,3,2,2,3,2,4,5,7,4,3,3,2,2,2,2,2,3,2,4,3,2,3,2,2,2,2,2,3,3,2,2,2,2,4,2,4,3,2,2,5,4,3,3,5,2,3,6,2,2,2,2,2,2,5,3,4,2,2,2,2,2,2,2,3,2,5,5,3,2,5,2,6,2,2,5,5,2,2,2,2,4,3,2,2,8,2,4,3,3,3,2,3,3,2,3,2,2,3,2,4,2,3,3,3,6,3,2,2,2,2,2,2,2,2,7,3,5,2,2,3,2,2,3,2,2,3,2,2,2,2,2,2,8,3,3,2,3,6,4,3,6,3,2,3,6,3,2,6,2,2,3,2,3,3,7,3,3,4,3,2,2,2,2,2,5,2,2,2,2,2,5,2,4,3,5,3,2,4,3,3,2,2,3,2,2,2,2,3,2,4,2,2,3,2,2,2,2,2,2,2,4,2,2,2,2,2,3,2,2,2,3,4,2,4,2,2,2,3,2,2,2,6,3,2,3,3,2,5,3,3,2,2,2,2,3,3,2,2,2,6,2,3,2,2,2,3,4,3,4,2,3,2,3,2,2,2,2,3,3,4,3,3,5,2,2,4,3,3,3,4,2,3,3,3,2,4,4,2,2,2,3,2,2,2,4,2,2,2,2,7,2,2,3,2,3,4,2,3,2,3,2,3,2,2,2,2,2,2,4,2,2,3,2,2,2,2,3,2,3,4,2,3,2,4,2,3,3,3,4,2,2,2,2,2,2,2,3,3,4,3,5,2,2,2,2,2,4,2,3,2,2,2,2,2,2,2,2,2,2,6,2,3,2,4,2,4,2,2,2,2,2,2,2,2,2,2,4,3,4,2,2,2,3,2,2,3,2,2,3,8,2,3,8,3,2,2,2,4,4,3,2,3,2,2,4,2,5,2,4,2,3,3,3,2,3,2,2,3,3,5,6,5,2,2,2,2,2,3,2,5,2,2,3,3,3,2,4,3,2],[58,52,74,57,30,66,67,82,21,45,29,39,71,58,71,55,52,86,29,68,62,72,73,59,57,53,78,46,64,53,62,70,34,65,69,74,59,83,47,65,72,53,77,54,63,46,85,55,64,62,71,50,83,58,41,56,69,68,65,64,57,70,81,59,69,53,73,70,46,41,77,65,68,46,47,63,75,59,42,75,55,64,58,73,64,39,73,65,48,20,64,78,34,73,51,61,52,75,34,65,33,58,65,33,16,69,47,64,67,65,65,71,69,68,68,62,68,67,64,63,70,60,51,65,45,61,72,20,75,69,62,78,65,41,81,66,60,59,47,36,79,49,79,82,60,57,72,90,71,47,78,72,82,64,61,70,56,77,59,73,78,84,56,26,64,75,64,72,62,67,62,67,58,66,79,32,72,67,47,47,63,67,65,67,67,74,66,74,72,47,67,72,69,43,73,48,77,50,75,64,69,65,61,56,51,49,54,53,39,49,68,70,60,37,74,57,52,16,65,46,66,71,52,74,54,60,39,70,52,58,53,51,49,48,69,66,58,50,33,66,47,75,78,61,53,68,73,67,66,58,68,63,69,80,73,53,47,76,73,71,66,76,67,69,66,63,62,57,45,89,42,63,55,70,47,57,50,71,41,70,84,64,70,74,69,61,61,69,61,54,58,73,63,20,32,69,59,34,78,62,65,70,46,44,73,64,67,53,64,61,69,47,73,58,44,70,51,53,65,65,64,68,68,61,55,55,66,64,64,45,72,63,63,70,63,80,67,57,66,51,62,68,45,76,76,70,63,68,47,32,33,75,70,63,70,66,71,68,39,64,65,62,68,59,72,58,64,39,49,45,46,46,77,84,67,55,76,70,68,69,87,54,77,67,61,75,76,64,38,66,71,67,65,47,68,63,68,47,54,36,63,72,63,96,69,61,84,71,71,66,77,79,78,61,66,63,52,65,48,76,67,40,64,57,67,74,64,71,70,77,39,63,72,57,72,67,69,70,69,71,54,75,79,64,56,69,47,63,57,36,60,62,69,55,42,56,77,47,54,51,68,66,72,64,57,45,43,61,67,69,57,70,55,65,56,60,62,72,20,52,70,67,69,62,72,48,69,69,49,66,67,80,70,70,78,61,63,62,67,70,56,56,45,74,61,70,72,64,73,75,57,63,67,52,40,89,44,56,59,70,65,54,65,66,52,74,73,66,43,67,51,53,68,61,49,52,65,75,59,69,70,53,64,60,71,72,55,79,77,52,70,42,72,62,54,73,40,52,69,73,62,57,45,73,68,73,70,72,65,62,67,68,69,56,52,56,73,58,58,74,47,54,66,66,72,69,62,69,36,65,60,54,73,72,67,63,79,76,60,63,67,57,74,63,52,66,56,66,71,65,65,34,65,64,54,58,60,51,62,71,72,66,64,45,67,73,71,51,66,66,63,74,77,81,51,53,52,76,86,67,70,56,48,65,68,77,68,63,57,63,55,68,73,65,41,57,77,55,53,51,61,33,70,51,69,63,67,14,65,62,58,70,57,59,56,55,60,78,64,56,68,31,51,68,38,77,76,41,61,70,54,46,58,48,47,75,66,67,41,33,62,41,66,61,58,69,71,58,59,67,61,59,61,78,63,76,65,63,59,82,64,57,85,29,56,64,76,57,82,70,65,47,62,68,77,77,78,71,47,78,66,67,70,82,77,72,47,70,71,65,58,56,56,61,73,72,70,68,66,66,61,53,57,73,77,74,69,65,61,59,78,71,51,56,71,49],["female","male","female","male","female","female","male","female","male","male","male","male","female","female","female","male","female","male","female","female","female","male","female","female","male","male","male","male","male","male","male","male","female","male","female","male","male","male","female","female","female","female","female","male","female","male","female","female","female","female","female","male","male","male","male","female","male","female","male","male","male","male","male","male","female","male","male","male","male","female","male","male","male","male","female","female","female","male","female","male","female","female","female","female","female","male","male","female","male","female","male","male","female","male","female","female","male","male","female","female","male","male","male","male","female","female","male","male","male","female","female","male","male","male","male","male","male","male","female","female","male","female","male","female","male","male","male","female","male","male","female","male","male","male","female","female","male","male","female","female","male","male","male","female","male","male","female","male","female","male","male","male","female","female","female","male","male","female","male","male","male","male","male","male","male","male","male","male","male","male","male","female","male","male","female","male","male","male","female","female","male","male","male","male","female","male","male","male","male","female","male","male","male","female","male","male","male","female","male","male","female","female","male","female","female","female","male","female","female","male","female","male","female","female","male","female","male","male","male","female","male","female","female","female","female","female","female","female","female","male","male","female","male","male","male","male","female","male","female","male","male","female","male","male","female","male","male","male","male","female","female","male","female","male","female","female","male","male","female","female","female","male","male","male","male","male","male","female","male","male","female","male","male","male","male","female","male","female","male","female","male","male","male","female","male","female","female","male","male","male","female","male","male","female","female","male","male","male","male","male","female","male","male","female","male","male","male","female","male","male","male","male","male","male","male","female","male","female","male","male","male","female","female","male","male","female","male","male","female","male","female","male","male","male","male","male","female","female","male","female","female","female","male","female","male","male","female","female","female","female","female","male","female","female","female","male","female","female","male","male","male","female","male","female","male","male","female","female","female","male","male","female","male","male","female","female","male","male","male","male","female","male","female","male","male","female","male","male","female","female","male","male","male","female","male","female","female","female","female","female","male","female","male","female","female","male","female","male","male","female","female","male","male","female","male","male","female","female","male","male","male","male","female","female","male","male","male","male","male","male","female","male","female","male","female","female","female","male","male","male","female","male","male","male","female","male","female","female","male","male","male","female","female","male","male","female","male","female","male","male","female","male","male","female","male","male","male","female","female","male","male","male","male","male","male","male","male","male","male","female","male","male","female","male","male","female","male","male","female","male","male","male","male","male","female","male","female","male","female","male","male","male","female","female","male","male","male","male","female","female","female","female","male","female","male","male","male","male","male","female","female","male","female","female","male","female","female","male","female","male","female","female","female","female","female","female","male","male","female","male","female","female","male","male","female","female","female","male","male","male","male","female","female","male","male","female","female","female","female","male","female","male","female","male","male","male","male","male","male","female","male","male","male","male","male","male","male","female","male","female","male","male","male","male","male","male","female","male","female","female","male","male","male","male","male","male","male","male","male","male","female","male","male","female","male","male","male","male","male","male","female","female","male","female","male","male","male","female","female","female","female","male","male","female","female","male","male","female","female","male","male","male","female","female","female","male","male","male","female","male","female","female","male","male","male","male","female","female","male","male","male","female","male","female","male","male","female","female","female","female","male","female","female","female","male","male","female","female","male","male","male","male","male","female","female","male","male","male","female","female","female","male","female","female","female","female","female","female","female","female","female","female","male","male","female","male","female","female","female","female","male","male","male","female","male","female","male","male","male","female","male","male","male","male","male","female","male","male","female","male","male","male","male","male","male","female","male","male","male","female","male","female","female","male","male","male","male","female","male","female","male","male","male","female","male","male","female","male","female","female","female","male","male","male","male","male","female","male","male","female","female","male","male","male","male","female","male","female","male","female","female","male","male","male","male","female"],["no","yes","no","yes","no","no","no","no","no","yes","yes","no","no","no","yes","yes","no","yes","no","no","yes","yes","yes","yes","yes","yes","no","no","no","no","no","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","no","no","no","yes","yes","no","yes","no","no","no","no","no","no","yes","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","yes","no","no","no","no","no","no","yes","no","yes","no","no","no","no","no","no","yes","yes","no","no","no","yes","yes","no","yes","no","yes","no","no","yes","no","yes","yes","no","no","yes","no","yes","yes","yes","no","yes","no","no","no","no","yes","no","no","yes","no","yes","yes","no","no","yes","no","no","no","no","yes","yes","yes","no","no","no","no","no","no","yes","yes","no","no","no","yes","yes","no","no","no","yes","no","yes","no","no","no","no","no","yes","yes","no","no","no","no","no","no","yes","no","no","no","no","yes","no","yes","yes","no","yes","no","no","yes","no","no","no","no","no","no","yes","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","yes","no","no","yes","no","no","yes","no","yes","no","no","no","no","no","no","no","no","yes","yes","yes","no","no","yes","no","no","no","no","no","no","no","no","yes","no","no","no","yes","no","no","no","yes","no","yes","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","yes","no","no","no","no","yes","no","yes","yes","no","yes","no","no","no","no","no","no","no","no","no","no","no","yes","no","yes","yes","no","yes","no","yes","yes","no","yes","yes","no","no","yes","no","yes","yes","yes","no","no","no","yes","no","no","no","no","no","yes","yes","no","yes","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","yes","yes","yes","no","yes","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","yes","yes","no","no","no","no","no","no","yes","yes","no","no","yes","no","no","yes","yes","yes","no","no","yes","no","no","no","no","no","no","no","no","no","yes","yes","yes","yes","no","yes","no","no","no","no","no","no","yes","no","yes","no","yes","no","no","no","no","yes","no","no","no","no","yes","yes","yes","no","no","no","no","no","yes","no","no","yes","no","no","yes","no","yes","no","no","yes","no","no","no","yes","yes","no","no","no","yes","yes","yes","yes","no","no","no","yes","yes","yes","no","no","yes","yes","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","yes","yes","yes","yes","yes","no","no","no","yes","no","yes","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","yes","yes","no","no","no","no","no","no","no","no","no","no","no","no","yes","yes","no","yes","yes","no","no","no","no","no","yes","no","no","yes","no","no","yes","no","no","no","no","no","yes","no","no","no","no","no","yes","no","no","no","yes","no","yes","yes","no","yes","yes","no","no","yes","yes","yes","no","no","yes","no","yes","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","yes","yes","no","yes","yes","yes","yes","no","yes","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","yes","no","no","yes","yes","no","no","no","no","no","yes","yes","yes","yes","yes","no","yes","yes","no","no","yes","no","no","yes","no","no","no","no","no","yes","yes","yes","yes","no","no","yes","no","no","no","no","no","yes","no","no","yes","no","no","yes","yes","no","yes","no","no","yes","no","no","no","no","no","no","yes","no","no","yes","no","no","no","no","no","yes","no","yes","no","no","no","no","no","no","no","yes","yes","no","no","yes","no","no","yes","yes","yes","no","yes","no","yes","yes","no","yes","no","no","no","yes","no","no","yes","yes","yes","no","no","yes","yes","no","no","yes","no","yes","yes","no","yes","yes","no","yes","no","yes","no","no","yes","no","no","yes","no","no","yes","no","yes","no"],["yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","no","no","no","no","yes","no","no","no","yes","yes","yes","no","yes","yes","no","yes","no","yes","yes","yes","yes","yes","no","no","no","yes","yes","yes","no","yes","yes","no","no","no","no","no","no","no","yes","yes","no","yes","yes","yes","no","no","yes","no","no","yes","yes","no","yes","no","no","no","no","no","yes","yes","yes","yes","yes","no","no","no","yes","yes","yes","no","no","yes","yes","no","yes","no","yes","yes","no","yes","no","yes","no","no","no","yes","no","yes","no","yes","no","no","yes","yes","yes","yes","yes","no","no","no","yes","yes","yes","no","yes","yes","no","no","no","yes","yes","no","yes","yes","yes","yes","yes","no","yes","yes","no","no","yes","no","yes","no","no","no","yes","no","yes","yes","yes","no","yes","no","no","no","yes","yes","no","yes","no","no","no","no","no","no","no","no","yes","yes","yes","yes","yes","yes","no","no","yes","no","no","no","no","no","yes","yes","no","no","no","yes","no","yes","no","yes","yes","yes","yes","no","no","yes","yes","yes","yes","no","no","no","yes","yes","yes","yes","no","yes","no","no","no","no","no","no","no","no","no","yes","yes","yes","yes","yes","yes","yes","no","no","no","no","no","no","yes","no","no","yes","yes","no","yes","no","yes","no","no","no","no","no","no","yes","no","yes","yes","yes","no","yes","yes","no","no","no","yes","no","yes","yes","no","no","no","no","no","yes","no","yes","no","yes","yes","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","no","no","no","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","no","yes","no","no","no","no","no","no","no","yes","yes","yes","yes","no","yes","yes","no","no","no","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","no","yes","no","no","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","no","yes","no","yes","yes","yes","yes","yes","yes","no","no","no","no","no","yes","no","yes","yes","no","no","no","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","no","no","no","no","yes","yes","no","yes","yes","no","no","no","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","no","yes","yes","yes","yes","yes","no","no","no","no","yes","yes","yes","yes","yes","yes","no","yes","no","yes","yes","no","no","no","no","no","no","no","no","no","no","no","yes","yes","no","no","yes","yes","no","no","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","no","no","no","no","no","no","no","no","no","no","yes","no","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","no","yes","yes","no","no","no","yes","yes","no","no","yes","yes","yes","no","no","yes","no","yes","no","yes","no","yes","yes","yes","no","no","yes","no","yes","yes","no","no","no","yes","no","yes","yes","yes","yes","yes","yes","yes","no","no","no","no","yes","yes","yes","yes","yes","yes","yes","yes","no","no","yes","yes","yes","yes","yes","yes","no","yes","no","no","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","no","no","yes","yes","yes","yes","yes","no","no","yes","no","yes","yes","yes","no","no","no","no","no","yes","yes","no","no","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","no","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","no","no","no","no","no","yes","no","no","yes","yes","yes","yes","yes","no","yes","yes","no","yes","yes","no","yes","yes","yes","yes","no","no","no","no","no","no","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","no","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","no","yes","no","yes","yes","yes","yes","no","yes","yes","yes","no","yes","yes","yes","yes","no","yes","no","no","no","yes","yes","yes","yes","yes","no","yes","yes","no","no","no","yes","yes","no","yes","no","yes","yes","yes","yes","yes","yes","no","yes","yes","no","yes","no"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>days<\/th>\n      <th>status<\/th>\n      <th>charlson_score<\/th>\n      <th>age<\/th>\n      <th>sex<\/th>\n      <th>complications<\/th>\n      <th>metastases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"autoWidth":false,"pageLength":4,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---
# Introduction
- Thus, such time-to-event data can be summarized by
  - tuples `\((t, \delta)\)`, where
      - `\(t\)` (`days`) indicates the time until the event (or censoring/truncation)
      - `\(\delta\)` (`status`) the status at time `\(t\)` (often `\(\delta \in \{0, 1\}\)`)
  - covariates `\(x\)` (e.g., `age`)

- "Standard" time-to-event analysis models the *hazard rate* &lt;br&gt;
  `$$\lambda(t; x) = \lambda_0(t)\exp(\beta \cdot x)$$`

  `\(\ra \exp(\beta)\)`: Multiplicative increase of the hazard for 1 unit increase of `\(x\)` (c.p.)

- Other quantities can be derived from the hazard rate
  - Cumulative Hazard: `\(\Lambda(t;x) = \int_{0}^{t} \lambda(s;x)\mathrm{d}s\)`
  - Survival Probability: `\(S(t;x) = \exp(-\Lambda(t;x)) = 1 - F(t)\)`

---
# Introduction
Analysis of such data is complicated because

- `\(t\)` cannot be observed fully (left-truncation, left-censoring, right-censoring, ...)

- competing events (other than the one of interest) can occur (recurrently)
    during the observation period (Competing Risks, Multistate Models)

- it takes time to observe `\(t\)`, consequently:

  - the effect of a covariate (observed at `\(t=0\)`) can change over time &lt;br&gt;
    `\(\ra\)` *time-varying effects* (TVE): `\(\lambda(t;x) = \lambda_0(t)\exp(\beta(t)\cdot x)\)`

  - covariates can change over time &lt;br&gt;
    `\(\ra\)` *time-dependent covariates* (TDC): `\(\lambda(t;\bfz) = \lambda_0(t)\exp(\beta \cdot z(t))\)`

  - combination of both &lt;br&gt;
  `\(\ra\)` *concurrent effects*: `\(\lambda(t;x) = \lambda_0(t)\exp(\beta(t) * z(t))\)` &lt;br&gt;
  `\(\ra\)` *cumulative effects* (later)

---
# Time-varying effect (TVE)
- The effect of a covariate observed (only) at the beginning of the follow-up `\((t=0)\)`
changes over the course of the follow-up:
`$$\lambda(t; x) = \lambda_0(t)\exp(\beta(t)\cdot x)$$`

- Often, this is the case for *scores* that describe a patient's health status
  at time of admission to the intensive care unit (ICU)/hospital
  - highly indicative of survival at the beginning of the follow-up

  - During the follow-up, the initial health status changes (due to treatment),
  thus the effect tends to go to zero over time (unless score describes conditions
  that worsen over time/can not be improved by treatment)

&lt;!--   - Usually, one assumes that `\(\beta(t)\)` is a smooth
  function, thus we denote TVEs by `\(f(t)\)` --&gt;

  - Example: `veteran` data (see [time-varying effects vignette](https://adibender.github.io/pammtools/articles/tveffects.html) for details and code) &lt;br/&gt;
  `\(\ra\)` Effect of the
  &lt;a href="image/p_karno_tv2.jpeg" align="middle"&gt; Karnofsky performance score over time&lt;/a&gt;


---
# Time-dependent covariates (TDC)

- The covariate is observed not only at the beginning of the follow-up `\((t=0)\)`
but also at different time-points during the follow-up:
.font80[
`$$\lambda(t; \bfz) = \lambda_0(t)\exp(\beta\cdot z(t))$$`
]
- Biomarkers, continuously updated clinical scores, ...

- often difficult to model:
  - updates irregular/different for different subjects (irregular grid)
  - no information on covariate values between updates

- Example `recidivism` data ([Rossi, Berk, and Lenihan, 1980](#bib-Rossi1980); [Fox and Weisberg, 2011](#bib-Fox2011))
  - 432 subjects released from prison where followed for 52 weeks
  - Each week the subjects' employment status was recorded
  `\(z(t)\in \{0,1\}, t = 1,\ldots,52\)`
  - See [vignette on time-dependent covariates](https://adibender.github.io/pammtools/articles/tdcovar.html) for details

---
# Cumulative Effects

- Let `\(z(\tz)\)` the value of a time-dependent covariate observed at
exposure time point `\(\tz\)`
- e.g., `\(z(\tz=1)=0.2, z(\tz=2) = 2.7, z(\tz=3) = 1.3, \ldots\)`
- The hazard at time `\(t=3\)` with a simple cumulative effect could be something like

.font90[
`$$\lambda(t=3;\bfz) = \lambda_0(t=3)\exp(\beta_1 z(\tz=1) + \beta_2 z(\tz=2) + \beta_3z(\tz=3))$$`
]

- However, usually we would expect that past observations are weighted by
a smooth function (that decreases with latency):

.font90[
`$$\lambda(t; \bfz) = \lambda_0(t)\exp\left(\sum_{\tz \leq t} h(t-\tz)z(\tz)\right)$$`

- the *partial effect* `\(h(t-\tz)\)` can again be estimated from the data via
penalized splines

]

---
# The Piece-wise Exponential Model (PEM)

The idea of the PEM is to

- divide the follow-up in `\(J\)` intervals `\((\kappa_{j-1}, \kappa_{j}], j=1,\ldots,J\)`

- create pseudo observations *pseudo-observations*
`$$\delta_{ij} =
  \begin{cases}
    1, &amp;\text{ if } t_i \in (\kappa_{j-1}, \kappa_j] \wedge \delta_i = 1\\
    0, &amp;\text{ else }
  \end{cases}$$`
and offsets `\(o_{ij} = \log(t_{ij})\)`,
  where `\(t_{ij} = \min(\kappa_j-\kappa_{j-1}, t_i-\kappa_{j-1})\)`

- estimate piece-wise constant hazards in each interval `\((\kappa_{j-1}, \kappa_j]\)`

- Survival times with (piece-wise) constant hazards have (piece-wise) exponential
distribution

---
# The PEM: Example


- Consider survival times following a Weibull distribution `\(T \sim WB(\alpha = 1.5, \lambda = 10)\)`

- The follow-up is partitioned in 10 Intervals `\((0,1], (1,2], \ldots, (9,10]\)`

&lt;img src="pammtools-slides-2018-06_files/figure-html/fig-ex-wb1-1.png" height="300px" style="display: block; margin: auto;" /&gt;

---
# PEM Example II
- Transform the data according to interval split points

.left-column[
&amp;nbsp;&amp;nbsp; standard format

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; status &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.right-column[
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
Piece-wise Exponential Data (PED) format

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; id &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; tstart &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; tend &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; interval &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; offset &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; ped_status &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; (0,1] &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.9942523 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; (0,1] &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0000000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; (1,2] &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0000000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; (2,3] &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -2.3025851 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; (0,1] &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0000000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; (1,2] &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.2039728 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


```r
glm(ped_status ~ interval, family = poisson(), offset=offset)
```




---
# PEM Example III


Even if approximation of the hazard is relatively crude, the approximation
of the cumulative hazard (piece-wise linear) and the survival probability
(piece-wise exponential) are usually good:

&lt;img src="pammtools-slides-2018-06_files/figure-html/ex-pem-1-1.png" height="300px" style="display: block; margin: auto;" /&gt;


---
# PEM Example IV
- (In theory) approximation of the hazard function becomes better with increasing
number of intervals (and `\(n\ra \infty\)`)

- In practice (finite `\(n\)`):
    - interval-specific hazard estimates become unstable
    - number of parameters increases
    - results sensitive to the placement and frequency of follow-up split points



&lt;img src="pammtools-slides-2018-06_files/figure-html/unnamed-chunk-3-1.png" height="300px" style="display: block; margin: auto;" /&gt;

---
# PEM Example V
Solution: Use many follow-up splits and estimate via penalized splines




```r
# PEM
glm(ped_status ~ interval, data = ..., family = poisson(), ...)
# PAM
gam(ped_status ~ s(tend, k = 10), data = ..., family = poisson(), ...)
```

&lt;a href = "pammtools-slides-2018-06_files/figure-html/ex-pem-vs-pam-1.png"&gt;

&lt;img src="pammtools-slides-2018-06_files/figure-html/ex-pem-vs-pam-1.png" height="375px" style="display: block; margin: auto;" /&gt;
&lt;/a&gt;



---
# Veteran data

```r
data("veteran", package="survival")
## transform to PED format
ped_veteran &lt;- as_ped(Surv(time, status)~., data = veteran, max_time = 400)
ped_veteran %&gt;% filter(id == 1) %&gt;% slice(c(1:4,(n()-3):n())) %&gt;% select(1:8)
```

```
##   id tstart tend interval    offset ped_status trt celltype
## 1  1      0    1    (0,1] 0.0000000          0   1 squamous
## 2  1      1    2    (1,2] 0.0000000          0   1 squamous
## 3  1      2    3    (2,3] 0.0000000          0   1 squamous
## 4  1      3    4    (3,4] 0.0000000          0   1 squamous
## 5  1     56   59  (56,59] 1.0986123          0   1 squamous
## 6  1     59   61  (59,61] 0.6931472          0   1 squamous
## 7  1     61   63  (61,63] 0.6931472          0   1 squamous
## 8  1     63   72  (63,72] 2.1972246          1   1 squamous
```

---
# PEM vs. Cox
- PEM and Cox PH are equivalent (w.r.t. to estimation of `\(\bsbeta\)`) if
  - there are no ties in the data
  - unique event and censoring times are used as split-points


```r
veteran2 &lt;-veteran %&gt;% group_by(time) %&gt;% slice(1) # exclude ties (for illustration)
# Cox model
cox &lt;- coxph(Surv(time, status)~ age + karno + trt, data=veteran2)
# Transform Data to PED format
ped_vet &lt;- as_ped(veteran2, Surv(time, status)~., cut=veteran2$time)
# Fit PEM
pem &lt;- glm(ped_status ~ interval + age + karno + trt,
  data=ped_vet, family = poisson(), offset = offset)
# Compare coefficient estimates
cbind(coef(pem)[102:104], coef(cox))
```

```
##               [,1]         [,2]
## age   -0.000803935 -0.000803935
## karno -0.028751097 -0.028751097
## trt   -0.071957932 -0.071957932
```

---
# PEM vs. PAM
- PAM only needs to estimate `\(k=10 &lt; J\)` parameters
- Estimates of neighboring hazards more similar due to penalization
- Can be feasibly extended to include multiple time-varying effects (later)


```r
# Transform Data to PED format
ped_vet &lt;- as_ped(veteran, Surv(time, status)~.)
# Fit Cox
cox &lt;- coxph(Surv(time, status)~ age + karno + trt, data=veteran)
# Fit PEM
pem &lt;- glm(ped_status ~ interval +  age + karno + trt, data=ped_vet,
  family = poisson(), offset = offset)
pam &lt;- gam(ped_status ~ s(tend, k=10) +  age + karno + trt, data=ped_vet,
  family = poisson(), offset = offset)
# Compare coefficient estimates
cbind(coef(pem)[98:100], coef(pam)[2:4], coef(cox))
```

```
##               [,1]         [,2]         [,3]
## age   -0.003780582 -0.002248585 -0.003864418
## karno -0.034233804 -0.033361569 -0.034443897
## trt    0.186008293  0.161836301  0.189546442
```


---
# TVE Karnofsky Score



```r
pam2 &lt;- gam(ped_status ~ s(tend)+trt+prior+ celltype+s(age)+te(tend, karno) ,
  data = ped_vet, family = poisson(), offset = offset)
gg_tensor(pam2, ci=TRUE) + labs(x="time", y = "karno")
```

&lt;img src="pammtools-slides-2018-06_files/figure-html/pam-tve-karno-1.png" height="300px" style="display: block; margin: auto;" /&gt;


---
# TVE Karnofsky Score

```r
p_tensor  &lt;- gg_tensor(pam2)
p_slice_karno &lt;- gg_slice(ped_vet, pam2, term="karno", tend=unique(tend),
  karno=c(40, 90), reference=list(karno=c(59)))
p_slice_time &lt;- gg_slice(ped_vet, pam2, term="karno", tend=c(51, 300),
  karno = seq_range(karno, n=100), reference=list(karno=c(59))) +
  geom_hline(yintercept = 0, lty = 3)
# patchwork
p_tensor + p_slice_karno + p_slice_time
```

&lt;a href="pammtools-slides-2018-06_files/figure-html/slices-karno-1.png"&gt;

&lt;img src="pammtools-slides-2018-06_files/figure-html/slices-karno-1.png" height="300px" style="display: block; margin: auto;" /&gt;
&lt;/a&gt;



---
# Tumor data: Data transformation

```r
data(tumor)
# ?tumor
str(tumor)
```

```
## Classes 'tbl_df', 'tbl' and 'data.frame':	776 obs. of  9 variables:
##  $ days          : num  579 1192 308 33 397 ...
##  $ status        : int  0 0 1 1 1 0 0 0 0 0 ...
##  $ charlson_score: int  2 2 2 2 2 2 2 2 2 3 ...
##  $ age           : int  58 52 74 57 30 66 67 82 21 45 ...
##  $ sex           : Factor w/ 2 levels "male","female": 2 1 2 1 2 2 1 2 1 1 ...
##  $ transfusion   : Factor w/ 2 levels "no","yes": 2 1 2 2 2 2 2 1 1 2 ...
##  $ complications : Factor w/ 2 levels "no","yes": 1 2 1 2 1 1 1 1 1 2 ...
##  $ metastases    : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
##  $ resection     : Factor w/ 2 levels "no","yes": 1 1 1 2 2 2 1 1 1 1 ...
```

```r
## transform to PED format
ped_tumor &lt;- as_ped(Surv(days, status)~., data = tumor, max_time = 3040)
```


---
# Tumor data: Model estimation
- All covariate effects are estimated as potentially time-varying



```r
pam_tumor_tve &lt;- bam(
  formula = ped_status ~
    # baseline hazard
    ti(tend) +
    # complications
    complications + ti(tend, by = as.ordered(complications)) +
    # metastases
    metastases    + ti(tend, by = as.ordered(metastases))    +
    # sex
    sex           + ti(tend, by = as.ordered(sex))           +
    # transfusion
    transfusion   + ti(tend, by = as.ordered(transfusion))   +
    # resection
    resection     + ti(tend, by = as.ordered(resection))     +
    # charlson comorbidity score
    s(tend, by = charlson_score) +
    # age
    s(tend, by = age),
  data = ped_tumor, family = poisson(), offset = offset,
  method = "fREML", discrete = TRUE)
```

---
# Tumor data: Results
See `?get_cumu_coef` to obtain data used for visualization.

&lt;a href="pammtools-slides-2018-06_files/figure-html/pam-tumor-viz-1.png"&gt;

&lt;img src="pammtools-slides-2018-06_files/figure-html/pam-tumor-viz-1.png" height="400px" style="display: block; margin: auto;" /&gt;
&lt;/a&gt;


---
# Custom visualization

- &lt;a href="https://adibender.github.io/pammtools/reference/newdata.html"&gt;`?make_newdata`&lt;/a&gt;

  - creates data set with specified covariate values (functions can be used)
  - sets all other covariates to mean values/reference category

- `add_*` functions add quantity of interest, e.g.,
  - `add_term`: term contribution to the log-hazard
  - `add_hazard`/`add_cumu_hazard`: Hazard and cumulative hazard
  - `add_surv_prob`: Survival probabilities




```r
# create newdata
new_df &lt;- ped_tumor %&gt;%
  make_newdata(tend=unique(tend), complications=unique(complications)) %&gt;%
  group_by(complications) %&gt;% #necessary for correct cumulative hazard and survival
  add_cumu_hazard(pam_tumor_tve) %&gt;% add_surv_prob(pam_tumor_tve)
```


---
# Custom visualization
&lt;a href = "pammtools-slides-2018-06_files/figure-html/viz-newdf-1.png"&gt;


```r
# plot
p_cumu &lt;- ggplot(new_df, aes(x = tend, y = cumu_hazard, fill = complications,
    ymin = cumu_lower, ymax = cumu_upper)) +
    geom_ribbon(alpha = 0.3) + geom_line(aes(col = complications))
p_surv &lt;- p_cumu + aes(y = surv_prob, ymin = surv_lower, ymax = surv_upper)
p_cumu + p_surv
```

&lt;img src="pammtools-slides-2018-06_files/figure-html/viz-newdf-1.png" height="300px" style="display: block; margin: auto;" /&gt;

&lt;/a&gt;


---
# Custom visualization

&lt;a href = "pammtools-slides-2018-06_files/figure-html/ex-term-viz-1.png"&gt;


```r
new_df2 &lt;- ped_veteran %&gt;%
  make_newdata(age = seq_range(age, n=20)) %&gt;%
  add_term(pam2, term="*age")
new_df2 %&gt;% slice(1:4) %&gt;% select(celltype, age, fit:ci_upper)
```

```
##   celltype      age       fit   ci_lower  ci_upper
## 1 squamous 34.00000 0.2212304 -0.2617815 0.7042424
## 2 squamous 36.47368 0.1960858 -0.2314386 0.6236103
## 3 squamous 38.94737 0.1710146 -0.2034332 0.5454624
## 4 squamous 41.42105 0.1461621 -0.1776060 0.4699302
```

```r
ggplot(new_df2, aes(x = age, y = fit)) +
  geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha=0.2) + geom_line()
```

&lt;img src="pammtools-slides-2018-06_files/figure-html/ex-term-viz-1.png" height="200px" style="display: block; margin: auto;" /&gt;
&lt;/a&gt;



---
# Cumulative effects

- In general the partial effect can be a tri-variate function of
  - `\(\tz\)` time at which exposure was observed
  - `\(z(\tz)\)` the value of the exposure observed at time `\(\tz\)`
  - `\(t\)` the follow-up time

- The cumulative effect is obtained by integrating over all `\(\tz\)` within a
pre-specified time-window `\(\mathcal{T}(t)\)`

`$$g(\bfz, t) = \int_{\mathcal{T}(t)} h(t, \tz, z(\tz))\mathrm{d}\tz \approx \sum_{\tz \in \mathcal{T}(t)} \Delta_{\tz}h(t,\tz,z(\tz))$$`

&lt;a href = "pammtools-slides-2018-06_files/figure-html/LL-ex-0-1.png"&gt;


```r
gg_laglead(0:10, tz=0:9, ll_fun = function(t, tz) {t &gt;= tz})
```
&lt;/a&gt;

---
# Cumulative effects


- Consider simulated data were a covariate was observed at time points
`\(\tz \in \{-5,-4,\ldots, 0, \ldots, 4, 5\}\)` (relative to the beginning of the
follow-up)

- The true hazard is given by
`\(\lambda(t; \bfz) = \lambda_0(t)\exp\left(\cdots + \sum_{\tz \leq t} h(t-\tz)z(\tz)\right)\)`


&lt;img src="pammtools-slides-2018-06_files/figure-html/wiz-sim_df-1.png" height="300px" style="display: block; margin: auto;" /&gt;

---
# Cumulative effects II

```r
head(simdf_wce)
```

```
## # A tibble: 6 x 7
##      id  time status     x1    x2 tz         z.tz      
##   &lt;int&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
## 1     1 3.62       1  1.96   2.67 &lt;dbl [11]&gt; &lt;dbl [11]&gt;
## 2     2 2.23       1 -0.939  1.15 &lt;dbl [11]&gt; &lt;dbl [11]&gt;
## 3     3 5.74       1  1.53   3.13 &lt;dbl [11]&gt; &lt;dbl [11]&gt;
## 4     4 3.07       1 -2.69   1.94 &lt;dbl [11]&gt; &lt;dbl [11]&gt;
## 5     5 1.73       1  1.20   2.68 &lt;dbl [11]&gt; &lt;dbl [11]&gt;
## 6     6 0.919      1 -0.727  1.23 &lt;dbl [11]&gt; &lt;dbl [11]&gt;
```

```r
simdf_wce %&gt;% slice(1) %&gt;% unnest() %&gt;% slice(1:4)
```

```
## # A tibble: 4 x 7
##      id  time status    x1    x2    tz   z.tz
##   &lt;int&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     1  3.62      1  1.96  2.67   -5. -0.606
## 2     1  3.62      1  1.96  2.67   -4. -1.77 
## 3     1  3.62      1  1.96  2.67   -3. -0.764
## 4     1  3.62      1  1.96  2.67   -2.  0.353
```

---
# Cumulative effects III

To estimate a cumulative effect of `z.tz` (using `mgcv`), the data has to be
transformed into a special PED format with matrix columns



```r
ped &lt;- as_ped(
  data = simdf_wce,
  formula = Surv(time, status) ~ x1 + x2| cumulative(latency(tz), z.tz, tz_var="tz",
    ll_fun = ll_fun),
  cut = seq(0, 10, by = 1))
str(ped, 1, give.attr=FALSE)
```

```
## Classes 'fped', 'ped' and 'data.frame':	4232 obs. of  11 variables:
##  $ id        : int  1 1 1 1 2 2 2 3 3 3 ...
##  $ tstart    : num  0 1 2 3 0 1 2 0 1 2 ...
##  $ tend      : num  1 2 3 4 1 2 3 1 2 3 ...
##  $ interval  : Factor w/ 10 levels "(0,1]","(1,2]",..: 1 2 3 4 1 2 3 1 2 3 ...
##  $ offset    : num  0 0 0 -0.474 0 ...
##  $ ped_status: num  0 0 0 1 0 0 1 0 0 0 ...
##  $ x1        : num  1.959 1.959 1.959 1.959 -0.939 ...
##  $ x2        : num  2.67 2.67 2.67 2.67 1.15 ...
##  $ tz_latency: num [1:4232, 1:11] 5 6 7 8 5 6 7 5 6 7 ...
##  $ z.tz      : num [1:4232, 1:11] -0.606 -0.606 -0.606 -0.606 0.618 ...
##  $ LL        : num [1:4232, 1:11] 1 1 1 1 1 1 1 1 1 1 ...
```

---
# Cumulative effects IV


```r
head(ped[ c("id", "interval", "tz_latency")])
```

```
##   id interval tz_latency.1 tz_latency.2 tz_latency.3 tz_latency.4
## 1  1    (0,1]            5            4            3            2
## 2  1    (1,2]            6            5            4            3
## 3  1    (2,3]            7            6            5            4
## 4  1    (3,4]            8            7            6            5
## 5  2    (0,1]            5            4            3            2
## 6  2    (1,2]            6            5            4            3
##   tz_latency.5 tz_latency.6 tz_latency.7 tz_latency.8 tz_latency.9
## 1            1            0            0            0            0
## 2            2            1            0            0            0
## 3            3            2            1            0            0
## 4            4            3            2            1            0
## 5            1            0            0            0            0
## 6            2            1            0            0            0
##   tz_latency.10 tz_latency.11
## 1             0             0
## 2             0             0
## 3             0             0
## 4             0             0
## 5             0             0
## 6             0             0
```

---
# Cumulative effects V


```r
head(ped[ c("id", "interval", "z.tz")])
```

```
##   id interval     z.tz.1     z.tz.2     z.tz.3     z.tz.4     z.tz.5
## 1  1    (0,1] -0.6062342 -1.7672798 -0.7640102  0.3530619  0.2941341
## 2  1    (1,2] -0.6062342 -1.7672798 -0.7640102  0.3530619  0.2941341
## 3  1    (2,3] -0.6062342 -1.7672798 -0.7640102  0.3530619  0.2941341
## 4  1    (3,4] -0.6062342 -1.7672798 -0.7640102  0.3530619  0.2941341
## 5  2    (0,1]  0.6183760  0.7555665 -1.3243787 -0.8964470 -0.7261960
## 6  2    (1,2]  0.6183760  0.7555665 -1.3243787 -0.8964470 -0.7261960
##       z.tz.6     z.tz.7     z.tz.8     z.tz.9    z.tz.10    z.tz.11
## 1 -1.8373356 -1.5140198 -1.5974425 -1.9023800 -0.6944021 -1.1958529
## 2 -1.8373356 -1.5140198 -1.5974425 -1.9023800 -0.6944021 -1.1958529
## 3 -1.8373356 -1.5140198 -1.5974425 -1.9023800 -0.6944021 -1.1958529
## 4 -1.8373356 -1.5140198 -1.5974425 -1.9023800 -0.6944021 -1.1958529
## 5 -1.5770317 -1.2048152 -1.2770681 -2.4785072 -2.4781543 -2.3054055
## 6 -1.5770317 -1.2048152 -1.2770681 -2.4785072 -2.4781543 -2.3054055
```

---
# Cumulative effects VI


```r
head(ped[ c("id", "interval", "LL")])
```

```
##   id interval LL.1 LL.2 LL.3 LL.4 LL.5 LL.6 LL.7 LL.8 LL.9 LL.10 LL.11
## 1  1    (0,1]    1    1    1    1    1    1    0    0    0     0     0
## 2  1    (1,2]    1    1    1    1    1    1    1    0    0     0     0
## 3  1    (2,3]    1    1    1    1    1    1    1    1    0     0     0
## 4  1    (3,4]    1    1    1    1    1    1    1    1    1     0     0
## 5  2    (0,1]    1    1    1    1    1    1    0    0    0     0     0
## 6  2    (1,2]    1    1    1    1    1    1    1    0    0     0     0
```

&lt;a href="pammtools-slides-2018-06_files/figure-html/ex-LL-1.png"&gt;


```r
gg_laglead(0:10, -5:5, ll_fun = function(t, tz) {t &gt;= tz}) +
gg_laglead(0:10, -5:5, ll_fun = function(t, tz) t &gt;= tz &amp; t &lt; tz + 3) +
gg_laglead(0:10, -5:5, ll_fun = function(t, tz) t == tz)
```

&lt;img src="pammtools-slides-2018-06_files/figure-html/ex-LL-1.png" height="200px" style="display: block; margin: auto;" /&gt;
&lt;/a&gt;




---
# Cumulative effects: Model estimation

.font80[

```r
mod_wce &lt;- gam(
  formula = ped_status ~ s(tend) + s(x1) + s(x2) + s(tz_latency, by = z.tz * LL),
  data = ped, family = poisson(), offset = offset, method = "REML")
summary(mod_wce)
```

```
## 
## Family: poisson 
## Link function: log 
## 
## Formula:
## ped_status ~ s(tend) + s(x1) + s(x2) + s(tz_latency, by = z.tz * 
##     LL)
## 
## Parametric coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.84397    0.04889  -37.72   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##                           edf Ref.df Chi.sq p-value    
## s(tend)                 6.344  7.374  309.7  &lt;2e-16 ***
## s(x1)                   1.001  1.002  419.3  &lt;2e-16 ***
## s(x2)                   3.676  4.549  263.6  &lt;2e-16 ***
## s(tz_latency):z.tz * LL 3.588  4.151  127.6  &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  -0.226   Deviance explained = 19.9%
## -REML = 2681.2  Scale est. = 1         n = 4232
```
]

---
# Cumulative effects: Results

```r
gg_slice(ped, mod_wce, term = "z.tz", tz_latency = seq(0, 15, by = 1),
  z.tz = c(1), LL=c(1))
gg_partial_ll(ped, mod_wce, "z.tz", tend = seq(0, 10, by = 1),
  tz_latency = seq(0, 15, by = 1), z.tz=c(1))
gg_cumu_eff(ped, mod_wce, "z.tz", z1 = 1)
```

&lt;img src="pammtools-slides-2018-06_files/figure-html/prod-viz-mod-wce-1.png" height="300px" style="display: block; margin: auto;" /&gt;


`\(\ra\)` [More examples (simulated data)](https://arxiv.org/pdf/1806.01042) &lt;br&gt;
`\(\ra\)` [Example nutrition in the ICU](https://adibender.netlify.com/slides/london12_2017/ercim-pamm#21)

---
# Summary

- PAMMs offer a powerful framework for time-to-event data analysis, including
  - multiple, smooth time-varying-effects
  - time-dependent covariates
  - cumulative effects of time-dependent covariates
  - [random effects](https://adibender.github.io/pammtools/articles/frailty.html)

- **`pammtools`** offers utility functions that handle
  - preprocessing: `as_ped`
  - post-processing: `make_newdata`, `add_*`
  - visualization: `gg_slice`, `gg_smooth`, `gg_tensor`, `gg_partial_ll`, ...


- help/feedback welcomed at https://github.com/adibender/pammtools/issues


---
# Links and Acknowledgments
- For more details on PAMMs/**`pammtools`**:
  - Bender, Andreas, and Fabian Scheipl. Pammtools: Piece-Wise Exponential Additive Mixed Modeling Tools. ArXiv:1806.01042 [Stat], June 4, 2018. http://arxiv.org/abs/1806.01042.
  - Bender, Andreas, Andreas Groll, and Fabian Scheipl. A Generalized Additive Model Approach to Time-to-Event Analysis. Statistical Modelling, February 14, 2018, 1471082X17748083. https://doi.org/10.1177/1471082X17748083.
  - Bender, Andreas, Fabian Scheipl, Wolfgang Hartl, Andrew G. Day, and Helmut Kchenhoff. Penalized Estimation of Complex, Non-Linear Exposure-Lag-Response Associations. Biostatistics, December 2, 2018. https://doi.org/10.1093/biostatistics/kxy003.

- Slides created via [Yihui Xie](https://twitter.com/xieyihui)'s R package [**xaringan**](https://github.com/yihui/xaringan)
with (modified) [Metropolis theme](https://slides.yihui.name/xaringan/#34)

- All graphics have been created using Hadley Whickham's [ggplot2](http://ggplot2.tidyverse.org/)

- Models are estimated using Simon Wood's [mgcv](https://cran.r-project.org/web/packages/mgcv/index.html)
([Wood, 2011](https://doi.org/10.1111/j.1467-9868.2010.00749.x); [Wood, 2017](#bib-Wood2017))

- Links:
&lt;a itemprop="sameAs" href="https://adibender.netlify.com/"&gt;
&lt;span class="fa fa-globe"&gt;&lt;/span&gt;
&lt;/a&gt;
&lt;a itemprop="sameAs" href ="https://github.com/adibender"&gt;&lt;span class="fa
 fa-github fa-lg fa-fw"&gt;&lt;/span&gt;
&lt;/a&gt;
&lt;a itemprop="sameAs" rel="noopener noreferrer" href="https://www.researchgate.net/profile/Andreas_Bender4" target="_blank"&gt; &lt;i class="ai ai-researchgate big-icon"&gt;&lt;/i&gt; &lt;/a&gt;
&lt;a itemprop="sameAs" href="//twitter.com/adiBender" target="_blank"&gt;
&lt;i class="fa fa-twitter big-icon"&gt;&lt;/i&gt; &lt;/a&gt;


---
# References
&lt;a name=bib-Cox1972&gt;&lt;/a&gt;[Cox, D. R.](#cite-Cox1972) (1972).
"Regression Models and Life-Tables". In: _Journal of the Royal
Statistical Society. Series B (Methodological)_, pp. 187-220.
ISSN: 00359246. URL:
[http://links.jstor.org/sici?sici=0035-9246%281972%2934%3A2%3C187%3ARMAL%3E2.0.CO%3B2-6](http://links.jstor.org/sici?sici=0035-9246%281972%2934%3A2%3C187%3ARMAL%3E2.0.CO%3B2-6).

&lt;a name=bib-Fox2011&gt;&lt;/a&gt;[Fox, J. and H. S.
Weisberg](#cite-Fox2011) (2011). _An R Companion to Applied
Regression_. Englisch. Revised.. Thousand Oaks, Calif: Sage Pubn.
ISBN: 978-1-4129-7514-8.

&lt;a name=bib-Friedman1982&gt;&lt;/a&gt;[Friedman, M.](#cite-Friedman1982)
(1982). "Piecewise Exponential Models for Survival Data with
Covariates". In: _The Annals of Statistics_ 10.1, pp. 101-113.
ISSN: 00905364. URL:
[http://www.jstor.org/stable/2240502](http://www.jstor.org/stable/2240502).

&lt;a name=bib-Holford1980&gt;&lt;/a&gt;[Holford, T. R.](#cite-Holford1980)
(1980). "The Analysis of Rates and of Survivorship Using
Log-Linear Models". In: _Biometrics_ 36.2, pp. 299-305. ISSN:
0006341X. DOI: [10.2307/2529982](https://doi.org/10.2307/2529982).
URL:
[http://www.jstor.org/stable/2529982](http://www.jstor.org/stable/2529982).

&lt;a name=bib-Rossi1980&gt;&lt;/a&gt;[Rossi, P. H, R. A. Berk and K. J.
Lenihan](#cite-Rossi1980) (1980). _Money, work, and crime:
experimental evidence_. En. Academic Press. ISBN: 9780125982405.

&lt;a name=bib-Whitehead1980&gt;&lt;/a&gt;[Whitehead, J.](#cite-Whitehead1980)
(1980). "Fitting Cox's Regression Model to Survival Data using
GLIM". In: _Journal of the Royal Statistical Society. Series C
(Applied Statistics)_ 29.3, pp. 268-275. ISSN: 0035-9254. DOI:
[10.2307/2346901](https://doi.org/10.2307/2346901). URL:
[http://www.jstor.org/stable/2346901](http://www.jstor.org/stable/2346901).

&lt;a name=bib-Wood2011&gt;&lt;/a&gt;[Wood, S. N.](#cite-Wood2011) (2011).
"Fast stable restricted maximum likelihood and marginal likelihood
estimation of semiparametric generalized linear models". In:
_Journal of the Royal Statistical Society: Series B (Statistical
Methodology)_ 73.1, pp. 3-36. ISSN: 13697412. DOI:
[10.1111/j.1467-9868.2010.00749.x](https://doi.org/10.1111/j.1467-9868.2010.00749.x).

&lt;a name=bib-Wood2017&gt;&lt;/a&gt;[Wood, S. N.](#cite-Wood2017) (2017).
_Generalized Additive Models: An Introduction with R_. Englisch. 2
Rev ed.. Boca Raton: Chapman &amp; Hall/Crc Texts in Statistical
Science. ISBN: 978-1-4987-2833-1.
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "zenburn",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
